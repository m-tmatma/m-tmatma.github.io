<html>
<head>
<!-- Start Google Analytics -->
<script async type="text/javascript" src="../googleanalytics.js"></script>
<!-- End Google Analytics -->
<meta name="google-site-verification" content="8Y9FzGJmBS8lXf2-5dS9kvKDfT7uJFyN2AF63K5LgJQ" />
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../style.css" type="text/css" rel="stylesheet" />
<title>git の submodule を最新に更新する</title>
<meta name="keywords" content="git" />
<meta name="keywords" content="commitID" />
<meta name="keywords" content="コミットID" />
<meta name="keywords" content="変数" />
<meta name="keywords" content="usebackq" />
<meta name="keywords" content="エスケープ" />
<meta name="keywords" content="git show" />
</head>
<body>
<div class="ads_top">
	<div class="responsive_googleads_top">
	<p>
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- responsive -->
		<ins class="adsbygoogle"
		     style="display:block"
		     data-ad-client="ca-pub-8722759789158430"
		     data-ad-slot="5744677742"
		     data-ad-format="auto"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>

		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- responsive2 -->
		<ins class="adsbygoogle"
		     style="display:block"
		     data-ad-client="ca-pub-8722759789158430"
		     data-ad-slot="6823799623"
		     data-ad-format="auto"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>

		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- responsive3 -->
		<ins class="adsbygoogle"
		     style="display:block"
		     data-ad-client="ca-pub-8722759789158430"
		     data-ad-slot="8280636932"
		     data-ad-format="auto"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
	</p>
	</div>
	<!-- end of "responsive_googleads_top" -->
</div>
<!-- end of "ads_top" -->



<div align="left">
	<div id="srchBox">
	<form action="https://custom.search.yahoo.co.jp/search" method="get" id="srch">
	<p id="srchForm">
	<input type="text" name="p" id="srchInput"><input type="submit" value="検索" id="srchBtn">
	<input type="hidden" id="fr" name="fr" value="cse">
	<input type="hidden" id="ei" name="ei" value="UTF-8">
	<input type="hidden" id="csid" name="csid" value="J0zMbP1PHIwqivqBjqOaAkRIovGsfNu3LxBX">
	</p>
	<input type="hidden" name="vs" value="m-tmatma.github.io" id="yjInsite">
	</form>
	<p id="srchLogo"><a href="http://www.yahoo.co.jp"><img src="https://s.yimg.jp/images/search/customsearch/yjlogo/yjlogo_type1_fffafa.gif" width="124" height="20" alt="powered by Yahoo! JAPAN"></a></p>
	<img src="https://custom.search.yahoo.co.jp/images/window/J0zMbP1PHIwqivqBjqOaAkRIovGsfNu3LxBX.gif">
	</div>
	<!-- /#srchBox -->
</div>
<div class="index">
	<a href="../sitemap.html">サイトマップ</a>
	<a href="../contact.html">連絡先</a>
	<a href="../">最初に戻る</a>
	<a href="./get-commit-id-JP.html">戻る</a>
	<a href="./ResolveConflictByRebase.html">次へ進む</a>
</div>
<div align="right">
$Date: 2018-07-07 06:49:13 +0900 (2018/07/07 (土)) $<br>
$Revision: 1347 $<br>
</div>

<h1>git submodule を含むリポジトリで mirror を作る方法</h1>

クラウド上や回線の細いリモートサイトに git server があって、そのリポジトリの中で submodule を使っている場合に
ローカルネットワークにミラーリポジトリを構築する方法を説明します。

<h2>前提知識</h2>

git submodule を登録する場合、通常絶対パス指定で submodule を登録すると思いますが、
git submodule は相対パスでも指定することが可能です。

<h2>サンプルの構成</h2>


<ul>
	<li>親リポジトリ (GitHub: submod-parant)</li>
	<ul>
		<li>Submodule 1 (GitHub: submod1)</li>
		<li>Submodule 2 (GitHub: submod2)</li>
	</ul>
</ul>


<ul>
	<li>ミラー親リポジトリ (Bitbucket: submod-parant)</li>
	<ul>
		<li>ミラーSubmodule 1 (GitHub: submod1)</li>
		<li>ミラーSubmodule 2 (GitHub: submod2)</li>
	</ul>
</ul>


<table>
<tr>
	<th>場所</th>
	<th>説明</th>
	<th>名前</th>
	<th>URL</th>
</tr>
<tr>
	<td>GitHub</td>
	<td>親リポジトリ</td>
	<td>submod-parant</td>
	<td>https://github.com/m-tmatma/submod-parant.git</td>
</tr>
<tr>
	<td>GitHub</td>
	<td>Submodule 1</td>
	<td>submod1</td>
	<td>https://github.com/m-tmatma/submod1.git</td>
</tr>
<tr>
	<td>GitHub</td>
	<td>Submodule 2</td>
	<td>submod2</td>
	<td>https://github.com/m-tmatma/submod2.git</td>
</tr>
<tr>
	<td>Bitbucket</td>
	<td>ミラーリポジトリ</td>
	<td>submod-parant</td>
	<td>https://m-tmatma@bitbucket.org/m-tmatma/submod-parant.git</td>
</tr>
<tr>
	<td>Bitbucket</td>
	<td>ミラー Submodule 1</td>
	<td>submod1</td>
	<td>https://m-tmatma@bitbucket.org/m-tmatma/submod1.git</td>
</tr>
<tr>
	<td>Bitbucket</td>
	<td>ミラー Submodule 2</td>
	<td>submod2</td>
	<td>https://m-tmatma@bitbucket.org/m-tmatma/submod2.git</td>
</tr>
</table> 


<h2>準備</h2>

GitHub 上で空の リポジトリを作成します。(https://github.com/new)

<ul>
	<li>submod-parant</li>
	<li>submod1</li>
	<li>submod2</li>
</ul>


Bitbucket 上で空の リポジトリを作成します。(https://bitbucket.org/repo/create)

<ul>
	<li>submod-parant</li>
	<li>submod1</li>
	<li>submod2</li>
</ul>


<h2>GitHub 上のリポジトリへのコード登録</h2>

<h3>GitHub 上に submodule 用のリポジトリ1 を登録する</h3>

<pre>
D:\demo>git clone https://github.com/m-tmatma/submod1.git
Cloning into 'submod1'...
warning: You appear to have cloned an empty repository.

D:\demo>cd submod1

D:\demo\submod1>echo test1 > test1.txt

D:\demo\submod1>git add test1.txt

D:\demo\submod1>git commit -m "add test1.txt"
[master (root-commit) fef6a0b] add test1.txt
 1 file changed, 1 insertion(+)
 create mode 100644 test1.txt

D:\demo\submod1>git push origin master
Enumerating objects: 3, done.
Counting objects: 100% (3/3), done.
Writing objects: 100% (3/3), 228 bytes | 228.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0)
To https://github.com/m-tmatma/submod1.git
 * [new branch]      master -> master
</pre>


<h3>GitHub 上に submodule 用のリポジトリ2 を登録する</h3>

<pre>
D:\demo>git clone https://github.com/m-tmatma/submod2.git
Cloning into 'submod2'...
warning: You appear to have cloned an empty repository.

D:\demo>cd submod2

D:\demo\submod2>echo test2 > test2.txt

D:\demo\submod2>git add test2.txt

D:\demo\submod2>git commit -m "add test2.txt"
[master (root-commit) 5bb30aa] add test2.txt
 1 file changed, 1 insertion(+)
 create mode 100644 test2.txt

D:\demo\submod2>git push origin master
Enumerating objects: 3, done.
Counting objects: 100% (3/3), done.
Writing objects: 100% (3/3), 226 bytes | 226.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0)
To https://github.com/m-tmatma/submod2.git
 * [new branch]      master -> master
</pre>



<h3>GitHub 上に 親リポジトリを登録する</h3>

<pre>
D:\demo>git clone https://github.com/m-tmatma/submod-parant.git
Cloning into 'submod-parant'...
warning: You appear to have cloned an empty repository.

D:\demo>cd submod-parant

D:\demo\submod-parant>echo test-parent > test-parent.txt

D:\demo\submod-parant>git add test-parent.txt

D:\demo\submod-parant>git commit -m "add test-parent.txt"
[master (root-commit) 3728826] add test-parent.txt
 1 file changed, 1 insertion(+)
 create mode 100644 test-parent.txt
 
D:\demo\submod-parant>git submodule add <strong>../submod1</strong> submod1
Cloning into 'D:/demo/submod-parant/submod1'...
remote: Enumerating objects: 3, done.
remote: Counting objects: 100% (3/3), done.
remote: Total 3 (delta 0), reused 3 (delta 0), pack-reused 0
Unpacking objects: 100% (3/3), done.
warning: LF will be replaced by CRLF in .gitmodules.
The file will have its original line endings in your working directory

D:\demo\submod-parant>git submodule add <strong>../submod2</strong> submod2
Cloning into 'D:/demo/submod-parant/submod2'...
remote: Enumerating objects: 3, done.
remote: Counting objects: 100% (3/3), done.
remote: Total 3 (delta 0), reused 3 (delta 0), pack-reused 0
Unpacking objects: 100% (3/3), done.
warning: LF will be replaced by CRLF in .gitmodules.
The file will have its original line endings in your working directory

D:\demo\submod-parant>git status
On branch master
Your branch is based on 'origin/master', but the upstream is gone.
  (use "git branch --unset-upstream" to fixup)

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        new file:   .gitmodules
        new file:   submod1
        new file:   submod2

D:\demo\submod-parant>git commit -m "add submodule"
[master e60d89e] add submodule
 3 files changed, 8 insertions(+)
 create mode 100644 .gitmodules
 create mode 160000 submod1
 create mode 160000 submod2


D:\demo\submod-parant>git push origin master
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 16 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (6/6), 614 bytes | 614.00 KiB/s, done.
Total 6 (delta 0), reused 0 (delta 0)
To https://github.com/m-tmatma/submod-parant.git
 * [new branch]      master -> master
</pre>

<h2>Bitbucket 上のリポジトリへのコード登録</h2>


<h3>Bitbucket 上に submodule 用のリポジトリ1 を登録する</h3>

<pre>
D:\demo\submod1>git remote -v
origin  https://github.com/m-tmatma/submod1.git (fetch)
origin  https://github.com/m-tmatma/submod1.git (push)

D:\demo\submod1>git remote add mirror https://m-tmatma@bitbucket.org/m-tmatma/submod1.git

D:\demo\submod1>git push mirror master
Enumerating objects: 3, done.
Counting objects: 100% (3/3), done.
Writing objects: 100% (3/3), 228 bytes | 228.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0)
To https://bitbucket.org/m-tmatma/submod1.git
 * [new branch]      master -> master
</pre>


<h3>Bitbucket 上に submodule 用のリポジトリ2 を登録する</h3>


<pre>
D:\demo\submod2>git remote -v
origin  https://github.com/m-tmatma/submod2.git (fetch)
origin  https://github.com/m-tmatma/submod2.git (push)

D:\demo\submod2>git remote add mirror https://m-tmatma@bitbucket.org/m-tmatma/submod2.git

D:\demo\submod2>git push mirror master
Enumerating objects: 3, done.
Counting objects: 100% (3/3), done.
Writing objects: 100% (3/3), 226 bytes | 226.00 KiB/s, done.
Total 3 (delta 0), reused 0 (delta 0)
To https://bitbucket.org/m-tmatma/submod2.git
 * [new branch]      master -> master
</pre>

<h3>Bitbucket 上に 親リポジトリを登録する</h3>


<pre>
D:\demo\submod-parant>git remote -v
origin  https://github.com/m-tmatma/submod-parant.git (fetch)
origin  https://github.com/m-tmatma/submod-parant.git (push)

D:\demo\submod-parant>git remote add mirror https://m-tmatma@bitbucket.org/m-tmatma/submod-parant.git

D:\demo\submod-parant>git push mirror master
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 16 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (6/6), 614 bytes | 614.00 KiB/s, done.
Total 6 (delta 0), reused 0 (delta 0)
To https://bitbucket.org/m-tmatma/submod-parant.git
 * [new branch]      master -> master
</pre>



<div class="ads_bottom">
	<div class="responsive_googleads_bottom">
	<p>
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- responsive_bottom1 -->
		<ins class="adsbygoogle"
		     style="display:block"
		     data-ad-client="ca-pub-8722759789158430"
		     data-ad-slot="4712927016"
		     data-ad-format="auto"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>

		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- responsive_bottom2 -->
		<ins class="adsbygoogle"
		     style="display:block"
		     data-ad-client="ca-pub-8722759789158430"
		     data-ad-slot="5590894411"
		     data-ad-format="auto"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>

		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- responsive_bottom3 -->
		<ins class="adsbygoogle"
		     style="display:block"
		     data-ad-client="ca-pub-8722759789158430"
		     data-ad-slot="5195023189"
		     data-ad-format="auto"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
	</p>
	</div>
	<!-- end of "responsive_googleads_bottom" -->
</div>
<!-- end of "ads_bottom" -->
</body>
</html>
